from collections import defaultdict
from runner import Runner
import sys
import heapq


real_input = """
#############################################################################################################################################
#.............#.........#...#...#.......#.......#.............#.....#.....................#.........#...................#.........#...#....E#
#.#.#####.###.#.#.#####.#.#.#.#.#.###.###.#.#.###.###.#######.#.###.#####.#####.#######.#.#.#######.#.#.###.###########.#.#########.#.#.#.#.#
#.#.#.....#.....#...#.....#.#.......................#.#...#...#.#.#.#...#.#...#.........#.#.#.....#.#.#.#...........#...#.#.......#.#...#.#.#
###.#.###.#.#######.#######.#########.###.#.#.#######.###.#.###.#.#.#.#.#.#.#.#.#.#####.#.#.#.###.#.###.#.#.#####.###.###.#.#####.#.#####.#.#
#...#...#...#.....#.#...#.............#...#.#.....#...#...#.....#.#...#.#.#.#.#.......#.#.#...#...#...#.#.....#.#...#...#.#...#.#.#.#.....#.#
#.#.###.#.###.#####.#.#.#############.#.#.#.#####.#.###.#.#######.###.#.###.#.###.#.###.#.###.#.#####.#.###.#.#.###.###.#.###.#.#.#.#.###.#.#
#.#.#...#.....#...#.#.#...#.........#...#.#.......#.#...#...#.........#.#...#.....#.#...#...#.#.#.......#...#...#.#.....#...#.#.#.....#.#.#.#
#.###.#.#.###.#.#.#.#.###.###.#####.#.###.#########.#.#####.#######.#.#.#.#######.#.#.#.###.###.###########.###.#.#######.###.#.#######.#.#.#
#.#.......#...#.#.#.....#...#.#...#.....#.....#.........................#...#...#.#.#.#...#...#.......#.....#...#.................#...#...#.#
#.#.###.#.###.#.#.#.#####.#.#.###.#.#.#######.#.#.#.#.###.#.#.###.###.#.#.#.#.#.#.###.#.#####.#.#####.#.#.###.#########.#########.#.#.###.#.#
#...............#.#.#...#.#.#.#...#.........#...#...#...#.#...#.......#.#.#...#.#.....#.....#.#.#...#.#.#.............#.#.......#.#.#.......#
#.###.#.#.#.#.###.###.#.###.#.#.#########.###############.#####.#####.#.#######.#.#.#.#.#.###.#.#.#.#.###############.#.#.#####.#.#.#####.#.#
#...#...#...#...#.....#...#.#.#.....#...#.....#...........#...#.#.............#.#...#.............#.#...........#...#.#.#...#...#.#.#.......#
###.###.#####.###########.#.#.###.#.#.#.#####.#.#####.#.###.#.###.###.#######.#.#.#####.###.#######.###########.#.###.#####.#.###.#.#######.#
#...#.#...#.......#.....#...#.....#.#.#.........#.#...#.#...#.#...#...#.....#...#.....#...#.#...#.#...#.....#.#.#.....#...#.#...#.#.#.....#.#
#.###.###.###.#.###.#.###.#####.#####.#####.###.#.#.#####.###.#.###.#.#.###.###.#####.#.#.#.#.#.#.###.###.#.#.#.#.#####.#.#.###.#.#.#.###.#.#
#.#.....#...#.#...#.#.......#...#.....#.....#...#.#.......#.#...#...#...#.#...#.#...#.....#.#...#.........#.#.#.....#...#.....#.#.#...#...#.#
#.#####.#.#.#.###.#.#####.#.#####.#####.#####.###.#########.#####.#######.###.###.#.#######.#.#.#####.#####.#.#.###.#.#######.#.#######.###.#
#.........#.....#.......#.#.......#...#.#...#.....#...#.........#.#.......#...#...#.......#.#.#.........#.....#...#...#...#.....#.........#.#
#.#######.#####.#########.#########.#.#.#.#.###.#.#.###.#.#######.#.#####.#.###.#######.#.#.#.#########.#####.###.#####.###.#####.#######.#.#
#...............#.........#.......#.#...#.#.#.....#.....#...#...#.#.#.....#.#.......#...#.....#.......#...#...............#...#...#.........#
###.#####.#####.#.###.#.###.#####.#.#####.###.#####.#######.#.#.#.#.###.#.#.#####.#.#.#####.#.#.#####.###.#########.#####.###.#.#.#.###.#.#.#
#...#...#.....#.#...#.#.#.....#...#.#.....#...#...#.#.#.....#.#.#.#.#...#.#.....#.#.#.....#.#...#...#.#.#...#.....#.#.....#.#.#.#.....#.#.#.#
#.#.#.###.###.#.#.###.#.###.#.###.#.###.#.#.###.###.#.#.###.#.#.#.#.#.#.#.#####.###.#####.#.#####.#.#.#.###.#.###.#.#.###.#.#.#########.#.#.#
#...#...........#.#...#...#.#...#.#...#.#.#.#.....#.#.#.....#.#...#...#.#.....#.....#...#.#.......#...#.....#...#...#.#.....#.....#...#.#...#
#.#.#####.#######.#.#####.#.###.#.###.###.#.#####.#.#.#####.#.#######.#.#######.#######.#.#######.#####.#######.#####.###########.#.#.#.###.#
#.#.....#...#.....#.#.....#...#.#...#.....#.....#...#...#...#.#.....#.#.......#.........#.#...#.........#.......#.....#...#.....#...#.#.....#
#.#####.#.#.#.#####.#.#.#######.#.#.#####.#####.#.###.###.#.#.#.###.###.#####.#.#####.###.#.#.#.#########.#####.#.###.#.#.#.#.#######.#####.#
#.....#...#...#.....#.#...#.....#.#.....#.....#.#...#.#...#.#.....#...#.....#.#...#.#...#.#.#...#.....#...#.#.....#...#.#...#.......#...#...#
#####.###.#####.#.###.###.#.#####.###.###.#####.###.#.#.#############.#######.###.#.###.#.###.#.#.###.#.###.#.#.#.#.###.###########.###.#.#.#
#...#...#.......#.#.....#.#.........#.....#...#.#.#...#.......#.............#.......#...#...#.#...#.#...#.....#.#.#.....#.........#...#.#.#.#
#.#####.#.#####.#.#######.#####.#######.###.#.#.#.#.#######.###.###.#######.#########.#.###.#.#####.###########.#.#######.#######.#.###.#.#.#
#.#.....#.....#.#.......#.#...#...#.........#...#.#.#.......#...#.........#.....#.....#.#...#...................#.#.#.....#.....#.#...#...#.#
#.#.#####.###.#.#######.#.#.#.#####.#####.#######.#.#.#####.#.#.#.#######.###.#.#.#####.#.###.#.#.#########.###.#.#.#.#.###.#.###.###.#####.#
#.#.#.....#.#.....#.#...#.#.#...#...#...............#.....#.#.#.#.......#...#.#.#.#.#...#...#.#.#.#.......#.#...#.#...#.#.....#...#.........#
#.#.#####.#.#####.#.#.###.#.###.#.###.###########.###.#.###.#.#.#.#####.###.###.#.#.#.#####.###.###.#####.#.#.#.#.#####.###.#.#.###.###.#.#.#
#.#.......#.#...........#...#.#...#...#.........#.#...#.....#.#.#...#...#.#.....#.#.......#...#.....#...#...#.#.#.#...#...#.#.....#.#...#.#.#
#.#########.#.#####.###.#.###.#.#######.#######.#.#.#########.#####.#.###.#######.#.###.#.#.#.#.#######.###.#.#.#.#.#.###.#.#######.#.###.#.#
#.....#.......#...#...#.#.#...........#...#.....#.#.#.....#...#...#.#.#...........#...#.#.....#.#.........#...#.#...#.#...#.#...#...#.#.#...#
#.###.#.#######.#.#####.#.#####.###.#.###.#.#######.#.###.#.###.#.#.#.###.#.#######.#.###.#####.#####.#.#######.#####.#.###.#.#.#.#.#.#.#####
#.#...#.#.....#.#...#...#.......#.....#...#.#.....#...#...#.....#...#...#.#.#.......#.....#...#.#.....#.#.....#.....#...#.#.#.#.#.#.#.......#
#.#####.#.###.#.###.#.###########.#####.###.#.###.###.#.#.#######.#.###.#.#.#.#############.#.#.#.#######.###.###.#.#####.#.#.#.#.#.#######.#
#.#.....#.#...#.#.#.#.....#...#.#.#.....#.#...#.#...#.#...#.....#.#.....#.#.#.#.......#.....#...#.......#...#.....#...#...#...#.#.#.....#.#.#
#.#.#####.#####.#.#.#.###.#.#.#.#.#.###.#.#####.###.###.#.###.#.#.#.###.#.#.#.#######.#.#########.#####.###.#######.###.#.#.#####.#####.#.#.#
#.#.......#...#.#.#.#.#.#.#.#...#...#.............#...#.#.....#.#.#.#...#.#.#.......#.....#...#.....#.....#...#.....#...#...#...#.........#.#
#.#####.###.#.#.#.#.#.#.#.#.#########.#########.#####.#.#######.#.#.#.#####.#######.#####.#.#.#.#####.###.###.#####.#.#######.#.#.#.#####.#.#
#.#...#.#...#.#.#...#...#.#.#.......#...#.#...#.#.....#...#.#...#...#.....#.......#...#...#.#...#...#.#.....#.#...#.#.....#...#.#.#.........#
#.#.#.#.#.###.#.###.#####.#.#.###.#.###.#.#.#.#.#.#######.#.#.###########.#####.#.###.#.###.###.#.#.#.#######.#.#.###.#####.###.#.###.#.#.#.#
#...#.#.#...#.#...#.#.....#...#.#.#.....#...#...#.........#.#...........#.#.....#.#...#...#...#...#.#.#.....#...#.....#...#.#.#...#.#.#.#...#
#.###.#.###.#.###.#.#.#####.###.#.#####.#######.###########.#######.#####.#.#######.#####.###.#####.#.#.###.###.#######.#.#.#.#####.#.#.#.###
#.#...#.#.#.#.....#...#...#.#...#.#.....#.....#...#.......#.....#...#.....#...#...#.....#.#...#...#...#.#.#...#...#...#.#...#.........#.#...#
#.#.###.#.#.#.#########.#.#.#.#.#.#####.#.###.#####.###.###.#.#.#.###.#####.#.#.#.#####.#.#.#.#.#.###.#.#.###.###.#.#.#.#####.#######.#.#.###
#.#.....#.#.#...#.....#.#...#.#.#.....#.#.#.#.....#...#...#.#...#.#...#.....#.#.#...#...#...#.#.#.....#.#...#...#...#.#.#.....#.....#.#.#...#
#.#######.#.###.#.#.#.#.#####.#######.#.#.#.#####.###.###.#.#.###.#.###.#####.#.###.#.#####.###.#####.#.#.#####.#.#####.#######.###.###.#.#.#
#.....#...#...#...#.#.#.#.....#...#...#.#.#.....#.#...#.#.#.#.#...#.#.#...#.#...#.#.#...#...#...#...#...#...............#.....#.#.#.....#.#.#
#####.#.#.###.#####.###.#.#.###.#.#.#####.###.###.#.###.#.#.#.#.###.#.###.#.#.###.#.###.#.###.###.#.#####.#############.#.###.#.#.#########.#
#...#...#.#...#...#.......#.#...#.#.....#.....#...#...#.#...#.#.#.#.#...#.#.......#.#...#.....#...#.........#.....#.....#...#...#.....#.....#
#.#######.#.###.#.#.#########.###.#####.#####.#.###.#.#.#####.#.#.#.#.###.#.#.###.#.#.###.#.#.###.#.#########.###.#########.#####.#.#.#.###.#
#...#...#.#.#...#.#...#.......#...#.....#...#.#.#...#.#.....#...#.#.#...#.#.#.#.#.#...#.....#...#...#.......#.#.#...........#.....#.#...#.#.#
###.#.#.#.#.#.###.###.#.#########.#.###.###.#.#.#.#.#.#.#######.#.#.#.#.#.###.#.#.#############.#.###.#####.#.#.#############.#####.#####.#.#
#...#.#.#.#.#.#.#...#.#.....#...#...#...#...#.....#...#.....#.....#.#.#.......#.#.#...........#.#...#.#...#...#...........#.#.#.#...#.....#.#
#.###.#.#.#.#.#.###.#.#####.#.#.#######.#.###.#############.#.#.#.#.###########.#.#.#.#.#####.#.###.#.#.#.#############.#.#.#.#.#.#####.###.#
#...#.#...#.......#.#.#...#.#.#.......#...#...#...........#...#...#...#...#.......#...#.#.#...#.#.#.#...#.#.........#...#.#.....#...#...#...#
#.#.#.###########.#.#.#.#.#.#.#.###.#.###.#.###.#######.#.#.###.#####.#.#.#.#######.#.#.#.#.###.#.#.#####.###.#####.#.###.#.#######.#.###.###
#.#.....#.......#.#...#.#...#...#...#.#...#...#...#.....#.#...#.#...#...#.#...#.....#...........#.......#.....#.#...#.#.#.#.#.....#.#.....#.#
#.#######.#####.###.#.#.###.###.#.#.#.###.###.###.#.#####.#.###.#.#.#####.###.#####.###################.#####.#.#.###.#.#.#.#.###.#.#.#####.#
#.#.#.....#...#.....#.#...#...#...#.#...#...#.....#.......#.#...#.#.......#.#.....#.......#.......#.......#.....#.....#...#.#...#...#.#...#.#
#.#.#.#######.#######.###.###.#####.###.###.#######.#######.#.#.#.#########.#####.#.#.###.#.#####.#########.###.###.###.#.#####.#####.#.#.#.#
#...#.....#.....#.....#.#.#.....#...#.#.#...#.#.....#...#...#...#.............#...#...#.#.#.....#.........#.#...#...............#.#...#.#...#
#####.#.#.#.###.###.#.#.#.###.###.###.#.###.#.#.#####.#.#.###.#.#####.#.#.###.#.#####.#.#.#.###.#######.#.#.#.#.#.#.#############.#.###.#####
#...#...#.#...#...#.#...#...#.#...#...#...#.......#...#.#.#...#.....#...#.#.#...#...#...#.#.........#...#...#.#...#.......#.................#
#.#.###.#.###.###.#.###.###.###.###.#####.#######.#.###.#.#.#####.#######.#.#####.#.###.#.#########.#.#######.#.#########.#.#.#.#.###.#.###.#
#.#.....#.....#.......#.#.....#...#...#...#.......#.#.#.#.#.#.#...#.....#...#.#...#.....#.....#.....#.......#...#.....#...#.#.#...#.#.#...#.#
#.#####.#.#.###.###.#.#.#.###.###.#.#.#.#.#.#######.#.#.###.#.#.###.#.#.###.#.#.#.###.###.#####.#######.#########.#.#.#.#.#.#.###.#.#.#.###.#
#.....#...#.#.......#.#.#...#...#.#.#.#...#...#.....#.#.......#...#.#.....#.#...#.#.#.#...#...#.#.....#...#...#.....#...#.#.#.#...#.#.#.#...#
#####.#.###.###########.#.#.#.###.#.#.#.#####.###.###.#######.#.###.#.#####.#.###.#.#.#.###.#.#.###.#.#.#.#.#.#.#.#.#.#.###.#.###.#.#.###.#.#
#.....#.#.......#.......#.#.#.....#.#.#.....#...#...#.......#...#...#.......#.#...#...#.....#.#...#.#.#.#.#.#...#.#...#...#.#...#...#.....#.#
#.#####.#.#####.#.#######.#.#########.#####.###.###.#.#######.###.###########.#.#.###.#######.###.#.#.#.#.#.#####.#.#####.#.###.###.#######.#
#.#.....#.#...#...#.......#.............#.#...#...#.......#.....#.#.....#.....#.#...#.#.........#...#.#.#.#.#.#...#.....#...#...#.#.....#...#
#.#.#####.#.#.#####.#######.###########.#.#.#.###.#.###.#.#.#####.#.###.#.#####.###.#.#.#######.#####.###.#.#.#.#.###########.###.#####.#.###
#.#.........#.#.......#.....#...#.....#...#.#...#.#...#.#.....#.......#.#.......#...#...#...#...#...#...#.#...#.#.#.........#.#.........#...#
#.#.#########.#########.#####.#.#.###.###.#.#####.###.#########.###.#.###.#.#####.#######.#.#.###.#.###.#.###.#.###.###.###.#.#######.#####.#
#.#...#.#...#.........#.#.....#.....#.#.#.#.........#.#...........#.#.....#.#...#...#...#.#...#...#...#.#.....#.....#...#...#.......#.#.....#
#.###.#.#.#.#########.#.#.###.#######.#.#.#####.###.#.#.#########.#.#######.#.#.###.#.#.#.#########.#.#.###.#######.#.#############.#.#.#####
#.#...#.#.#...#...#...#.#...#...#.....#.#.....#...#...#.#.........#.#.........#.#.....#.#.#.........#.#...#.#.....#.#...............#.#.....#
#.#.###.#.###.#.#.#.###.###.#.#.#.#####.###.###.#####.#.#.#.#####.#.#.#########.#.###.#.#.#.###.#########.###.###.#.#############.#.#.#####.#
#.#.....#.#.#.#.#.#.....#.#...#.#.#.........#...#.....#.#.#...#.#.#.#...#...#...#.#.......#...#.........#.....#...#.............#.#.....#...#
#.#######.#.#.#.#######.#.###.###.#.#####.#.#.#.#.#####.#.###.#.#.#.#.###.#.#.#.#.#####.#####.#########.#######.###.###.#.###.###.###.###.###
#...#...#...#.#.......#...#...#...#.....#.#.#.#.#.#.#...#...#.#.#.#...#...#...#.#.....#...#...#...............#.#.#.#...#...#...#...........#
###.#.#.###.#.#######.###.#.#.#.###.###.###.#.###.#.#.#######.#.#.#.###.#######.#####.###.#####.###############.#.#.#.#.#######.#.#.#.#####.#
#...#.#.#...#.......#.....#.#.#.#...#.#.....#.#...#.#...#.....#...#.....#.....#.#.#...#.#...#...#.........#.....#...#.#.........#.#.#.......#
#.###.#.#.#.#######.#.#####.#.#.#.###.#######.#.###.###.#.#####.#########.###.#.#.#.###.###.#.###.#######.#.#####.###.#####.#####.#.#.###.###
#.....#.........#...#...#...#.#.#.....#.....#.........#.#.....#...#...#.....#.#.#.#...#.#.....#...#...#...#.#.......#...#...#.....#.........#
#.###############.#######.###.#.###.#.#.###.#####.#####.#####.###.#.###.###.###.#.###.#.#.#.###.###.#.#.###.#.#####.###.#.###.#####.#.#####.#
#.....#...#.....#.......#.#...#...#.#...#.....#.......#.....#...#...#.....#...#.#.#...#...#.......#.#.#...#.#.#...#.#...#.....#...#.........#
#####.#.#.#.###.#.#####.#.###.###.#.#.###.#.###.#####.#####.###.###.#.#######.#.#.#.#####.#.###.###.#.###.#.###.#.#.#.#####.#####.###.#####.#
#.#...#.#...#.#.#.#.....#...#.#...#.#.....#.#...#...#...#...#.......#.#.......#...#.....#.#...#.....#.....#.#...#.....#.....#.....#.......#.#
#.#.#.#.#####.#.#.#.###.###.#.#.###.#####.###.#.###.#.###.###.###.#.#.#.#####.###.#####.#.#.###.###.#######.#.###.#####.#####.###.#.#.###.#.#
#...#...#.....#...#.#.#.#.#...#.#.......#.#...#.....#.....#.....#...#.#.....#.#...#...#.#.#.#...#...#...#...#...........#.....#...#.#.....#.#
#.###.###.#######.#.#.#.#.###.#.#.###.#.#.#.#####.#########.###.#####.#####.###.###.#.#.###.#.#######.#.#.###.#############.###.###.#.###.#.#
#.................#.#.......#.#.#.#...#...#.....#.....#...#...#.......#...#.......#.#.#.....#.#.......#.#...#...#...........#.#.....#...#.#.#
#.#.#.#########.#.#.#.#######.#.###.#.#########.#.#.#.#.#.###.#####.###.#.#.#.###.#.#.#######.#.#######.###.#.#.#.#.#####.#.#.#.#####.#.###.#
#...#.........#...#.#.#.......#.#...#...............#...#.#.#.#.....#.#.#.#.#...#.#.#...#...#.#.......#...#.#.#.#.#.#...#...#...#.....#.....#
#####.#######.#.###.#.#.#######.#.#################.#####.#.#.#.###.#.#.#.###.###.#.###.#.###.#######.#.###.###.#.#.#.#.#########.###.#######
#...#.......#.#.....#.#.#.....#.#.#.................#.......#.#...#...#.#.....#...#...#.#.#.....#.........#.#...#.#...#.#...#.....#.#.......#
#.#.#########.#####.###.#.#.#.#.#.###.#.###.#########.#######.#.#.###.#.###.###.###.#.#.#.#.###.#.#######.#.#.###.#####.#.#.#.###.#.#.#####.#
#.#.....#.....#...#.#.....#.#.#.#...#.#.#...#.....#.......#...#.#.....#.#.....#.#.....#.#.#.#...#.#.....#...#.#.#...#.#.#.#.#.#.....#.#.#...#
#.#####.#.#####.###.#.#####.#.#.###.###.###.#.###.#########.#########.#.#.###.#.#####.#.#.#.###.#.#.###.#####.#.###.#.#.#.#.#.#.#.###.#.#.#.#
#.#...#.#.....#...#.#.....#.#.#...#...#...#.#.#.#.........#.....#...#.#...#.#...#.....#.#.#...#.#.#.........#.#.....#.#...#...#.#.....#.#.#.#
#.#.#.#.#####.#.#.#.#####.#.#####.###.###.###.#.#########.#####.#.#.#.#####.#####.#####.#.###.###.#.#.#####.#.###.###.#.#.#####.#.#####.#.###
#.#.#.#.......#.#.....#...#.....#...#.#...#...#.......#.....#...#.#...#.........#...#.....#...#.....#...#.#.#...#.....#...#...#...#.....#...#
#.#.#######.#########.#.#######.#.###.#.#.#.###.#.#####.#####.###.###.###.#.###.###.#####.#.###.###.###.#.#.###.#####.#######.#.#.#####.###.#
#.#.........#.....#...#.......#.#...#.#.....#...#.#...#.......#.#...#...#.#...#.#.......#.#...#.#.....#.#.....#...#.#...#.....#...........#.#
#.#.#########.###.#.#.#####.#.#.###.#.#.#####.#.###.#.#.#.#####.#.#.#.#.#####.#.#.#.#.#.#####.#.#######.#.###.###.#.###.#.#######.#####.###.#
#.#.#.........#.#.#.#.......#...#.#...#.#.....#.#...#.#.#.#.....#.....#.....#.#...#.#.#.....#.#.#.....#...#.#.....#...#.#...........#...#...#
#.###.#########.#.###.###.#####.#.#####.#.#.#####.###.#.#.#.###.#.###.#.###.#.#######.###.###.#.#.###.###.#.#######.#.#.#.#######.#.#.#.#.###
#...#.#.....#...#.......#.#.....#...#...#.#.........#.#...#.#...#...#.....#.............#...#.#...#.#.....#.......#.#.#.#.....#...#.....#...#
#.#.#.#.###.###.#########.#.#######.#.###.#########.#.#####.#.#####.#####.#.#####.#.#######.#.#####.###########.#.#.###.###.###.#.#####.###.#
#.#...#.#.#.....#.....#...#.#.#.....#.#...#.#.....#.#.........#.......#...#.....#.#...#.....#.........#.........#...#...#...#...#...........#
#.#####.#.###.###.#.#.#.###.#.#.#.###.#.###.#.###.#.#######.#.#.#######.#######.#.#.###.###.###.#.#.###.#.#########.#.#######.###.#####.###.#
#.......#.....#...#...#.....#.#.#.....#.#...#.#...#.#...#...#.#.#...#...#...#...#.#...#...#.#.#...#.#...#.....#.....#.......................#
#.#.###########.#.#.#########.#.###.###.###.#.#.###.#.#.#.#####.###.#.###.#.#.###.###.###.#.#.#####.#.#######.#.###############.#######.#.###
#.#.......#.....#.#...............#...#...#.#.#...#.#.#.#.........#.#.....#.#.#.......#.#.#...#...#.#.......#.#.#.........#...#...........#.#
#.#######.#.#####.#######.###.###.#.#####.#.#.###.#.###.#########.#.#######.#.#######.#.#.###.#.#.#.#######.#.###.#####.#.#.###.###########.#
#.......#...#...#.......#...#.#...#.........#.#...#.....#.....#.#...#...#...#.#.....#.#.#...#...#.#...#.....#...#.#...#.#...#...#...........#
#######.#####.###.#.###.#.#.#.#.###.#########.#.#########.###.#.#.###.#.#.###.#.###.#.#.###.#.###.###.#.#######.#.#.#.#.#####.###.#######.###
#.....#...............#...#.#.#...#.#.......#.#.#.......#.#...#...#...#.............#.#...#.#.#.......#.#...#...#...#.#.....#.#.#...#...#...#
#.#######.#.#.#.#####.#.#.#.#.#.#.#.#.#####.#.#.#.#####.#.#.###.###.#######.#.#.#.#.#.#.#.#.###.#.#####.#.###.#.#.###.#####.#.#.###.#.#####.#
#.#.....#.#.#.#.#...#.#.#...#.#.#.#.#...#.#...#...#...#...#.#.#...#.........#.#.#.#.#...#.#...#.#.#.....#.#...#.....#.#...#...#...#.#.#.....#
#.#.###.#.#.#.#.###.#.###.###.#.#.#####.#.#########.#######.#.#.###.#.#.###.#.#.#.#.#########.#.#.#.#####.#.#####.#.#.###.#######.#.#.#.###.#
#.#...#.#.#.#.#.....#.#...#.....#.......#...#.....#.......#.#...#...#.#.#.....#.#...................#.....#.#.#.....#...#.......#.....#...#.#
#.###.#.#.#.#######.#.#.#.#####.#########.###.###.#.#####.#.###.#.###.#.#.#####.###.#####.#.#####.#.#.#.###.#.#.#.#####.###.###.#.#######.###
#...#.#...#...#.....#.#.#.....#.........#.....#.#.#.#...#.#...#.#...#...#.........#.......#...........#.#...#...#...#...#...#...#.#.....#...#
#.###.#######.#.#####.#.#.###.#.#####.###.#####.#.#.#.#.#.###.#####.###.#####.###.#####.###.#####.###.#.#.###.#####.#.###.###.#####.###.###.#
#.....#...................#...#.....#.....#.....#...#.#.....#.#...#...#.....#.#.#.....#...#.........#...#...#.#.....#.#...#...#.....#...#...#
#.#####.###.#.#.#.###.#####.###.###.#.#.###.###.#####.#######.#.#.###.#####.#.#.#####.###.###.#########.#.#.#.#.#####.#.###.#####.###.###.###
#.....#.#.#.#...#...#.....#.....#...#.#.#...#.#.....#.........#.#...#.#...#.#...#.....#...#...............#.....#...#...#...#...#.#.#...#...#
#.###.#.#.#.#######.#####.#######.#####.#.###.#####.###########.###.#.#.###.#####.#.###.#######.###.#.#.#.#######.#.#####.###.#.#.#.###.###.#
#S......#...........#...........#.........#.....................#.....#...........#.............#.....#.#.........#...........#...#.........#
#############################################################################################################################################
"""


directions = [complex(0, 1), complex(1, 0), complex(0, -1), complex(-1, 0)]

class TodayRunner(Runner):
    def parse(self, input):
        self.width = len(input[0])
        self.height = len(input)
        self.map = defaultdict(lambda: '')
        for i in range(self.height):
            for j in range(self.width):
                val = input[i][j]
                self.map[complex(i,j)] = val
                if val == 'S':
                    self.start = complex(i,j)
                elif val == 'E':
                    self.end = complex(i,j)

    def insert(self, queue, new):
        for i, q in enumerate(queue):
            if new[1] <= q[1]:
                new_queue = queue[:i] + [new] + queue[i:]
                return new_queue
        return queue + [new]

    def part_a(self):
        self.weights = defaultdict(lambda: {})
        dir = directions[0]
        # pos, weight, direction
        queue = [(self.start, 0, dir)]

        while len(queue):
            (pos, weight, dir) = queue.pop(0)

            if pos == self.end:
                return weight
            neighbors = [(pos + d, d) for d in directions if self.map[pos + d] != '#']
            
            for (n_pos, n_dir) in neighbors:
                w_diff = 1
                if dir != n_dir:
                    w_diff += 1000
                n_weight = weight + w_diff
                if n_dir not in self.weights[n_pos] or self.weights[n_pos][n_dir] > n_weight:
                    self.weights[n_pos][n_dir] = n_weight
                    queue = self.insert(queue, (n_pos, n_weight, n_dir))
    
    def part_b(self):
        pass


test_input = """
#################
#...#...#...#..E#
#.#.#.#.#.#.#.#.#
#.#.#.#...#...#.#
#.#.#.#.###.#.#.#
#...#.#.#.....#.#
#.#.#.#.#.#####.#
#.#...#.#.#.....#
#.#.#####.#.###.#
#.#.#.......#...#
#.#.###.#####.###
#.#.#...#.....#.#
#.#.#.#####.###.#
#.#.#.........#.#
#.#.#.#########.#
#S#.............#
#################
"""


if __name__ == "__main__":
    runner = TodayRunner(test_input, real_input)
    print(runner.run('-v' in sys.argv))