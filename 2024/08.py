from runner import Runner
import sys
from collections import defaultdict
import itertools

class TodayRunner(Runner):
    def parse(self, input):
        self.map = defaultdict(lambda: '')
        self.height = len(input)
        self.width = len(input[0])
        self.antennae = defaultdict(lambda: [])
        for i in range(len(input)):
            for j in range(len(input[0])):
                self.map[(i, j)] = input[i][j]
                if input[i][j] != '.':
                    self.antennae[input[i][j]].append((i, j))
        
    
    def part_a(self):
        antinodes = set([])
        for freq, coords in self.antennae.items():
            for [a1, a2] in list(itertools.combinations(coords, 2)):
                x_diff = a1[1] - a2[1]
                y_diff = a1[0] - a2[0]
                an1 = (a1[0] + y_diff, a1[1] + x_diff)
                an2 = (a2[0] - y_diff, a2[1] - x_diff)
                if self.map[an1] != '':
                    antinodes.add(an1)
                if self.map[an2] != '':
                    antinodes.add(an2)
        return len(antinodes)


    def part_b(self):
        antinodes = set([])
        for freq, coords in self.antennae.items():
            if len(coords) == 1:
                continue
            else:
                for [a1, a2] in list(itertools.combinations(coords, 2)):
                    x_diff = a1[1] - a2[1]
                    y_diff = a1[0] - a2[0]

                    antinodes.add(a1)
                    an1 = a1
                    while self.map[an1] != '':
                        an1 = (an1[0] + y_diff, an1[1] + x_diff)
                        if self.map[an1] != '':
                            antinodes.add(an1)

                    an2 = a1
                    while self.map[an2] != '':
                        an2 = (an2[0] - y_diff, an2[1] - x_diff)
                        if self.map[an2] != '':
                            antinodes.add(an2)
        return len(antinodes)


test_input = """
............
........0...
.....0......
.......0....
....0.......
......A.....
............
............
........A...
.........A..
............
............
"""

real_input = """
.I.........................................U......
.....................9.......N........G.........U.
....................................GN............
...j.....A...S....................................
.j...o...S......t.....9...........................
..................................................
.....3...................9.....................G..
..I.....3...........................iG.x..2.......
......o...j...Sh.......x...t..........U....2......
.r...I.o.b.w.....h...............U............M..i
3...w......7......................................
......S.r.......h...................N.............
........7..r..........5.h.........................
....J.......7B......x...O..........y..............
......I...J..a..x..............O.......H..........
w..Fj..............t.O................H......2....
........a..m..........y...O.4.............l.......
.....Jm....................4......................
..m.......................2.Ny..............M.H...
.......a................X.....5k.....M.........H..
.........F...........A...................M.K......
.......7...........m....t...y.........K...........
....i.....................B.......................
.................5................6...............
........b..T................ABK....i..............
....................s..................K..........
.....w...J.............s.................W......n.
..............F........X...8......................
...........4..................s...........W....f..
.........g.....so.B.9..Y........4............6...f
..................................................
b......1....................8..................W..
Lb...g.R..0...................Y................l..
................................n...........f...l.
..........g..............n8.....k......6..........
.....R....A0.......................n..........W..l
...............................d..............6...
........................k..................D......
...0............X......8.k........F...............
....a....L..............Y.................D.......
.........1...L.........u...D.......Yd.............
.............................d...u................
........R...................................D....X
............L.g.0.................................
..................................................
..............................T...................
........................T.........................
....................u..........T..................
....1...................u.........................
..................R...................d...........
"""


if __name__ == "__main__":
    runner = TodayRunner(test_input, real_input)
    print(runner.run('-v' in sys.argv))